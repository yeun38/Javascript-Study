# 23장 실행 컨텍스트

실행 컨텍스트는 자바스크립트의 동작 원리를 담고 있는 핵심 개념이다.
실행 컨텍스트는 이해하면 호이스팅 발생 이유, 식별자 관리 방식, 클로저의 동작 방식, 비동기 처리 방식 등 을 이해할 수있다.

4가지의 소스코드가 존재하며 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이 달라진다.

- 전역 코드
  - 전역 변수 관리를 위한 최상위 스코프인 전역 스코프 생성
  - var 키워드로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수가 전역 객체와 연결 되어야한다.
- 함수 코드
  - 함수 코드는 지역 스코프를 생성하고, 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결해야 한다.
- eval 코드
  - 엄격모드에서 자신만의 독자적인 스코프를 생성한다.
- 모듈 코드
  - 모듈별로 독립적인 모듈 스코프를 생성한다.

<br/>

## 소스코드의 평가와 실행

소스 코드는 2개의 과정으로 **"소스코드의 평가"**, **"소스코드의 실행"** 으로 나누어 처리한다.

**소스코드의 평가** : 실행 컨텍스트를 생성하고 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 **<span style="color:Lightseagreen">스코프(렉시컬 환경의 환경 레코드)에 등록한다.</span>**

**소스코드의 실행** : 선언문을 제외한 소스코드가 **순차적으로** 실행된다. **<span style="color:Lightseagreen">즉 런타임이 시작된다. </span>**

이 때 소스코드 실행에 필요한 정보, 즉 변수나 함수의 참조를 렉시컬 환경에서 검색해서 취득하며, 변수 값의 변경 등 소소코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록한다.

```javascript
// 전역 변수 선언
const x = 1;
const y = 2;

// 함수 정의
function foo(a) {
  // 지역 변수 선언
  const x = 10;
  const y = 20;

  // 메서드 호출
  console.log(a + x + y); // 130
}

// 함수 호출
foo(100);

// 메서드 호출
console.log(x + y); // 3
```

👉 실행 결과

    130
    3

다시 정리하면, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.

실행 컨텍스트의 렉시컬 환경은 식별자와 소코프를 관리하고,

코드 실행 순서는 **실행 컨텍스트 스택**으로 관리한다.

<br/>

### 실행 컨텍스트 스택

```javascript
const x = 1;

function foo() {
  const y = 2;

  function bar() {
    const z = 3;
    console.log(x + y + z);
  }
  bar();
}

foo(); // 6
```

![실행 컨텍스트 스택 ](https://miro.medium.com/max/1400/1*0FSent9cSo2b5ggUdtKPWQ.png)

- 실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 현재 실행 중인 코드의 실행 컨텍스트다. 따라서 **실행 중인 실행 컨텍스트**라 부른다.
- 전역에 있는 코드가 마지막 라인까지 모두 실행되면 전역 실행 컨텍스트도 종료된다.
